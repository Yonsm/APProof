function localize(t,i){var a="define(function(){ return "+JSON.stringify(i)+";})";store.setItem(t,a)}function checkVersion(t,i){require([versionKey],function(a){store.getItem(versionKey)||localize(versionKey,a);var e=config.dataServer+config.versionURL;$.getJSON(e,function(e){rv=e,lv=a;var n=e[t],s=a[t],o=n!=s;i&&i(o,{localVersion:s,remoteVersion:n,local:a,remote:e})})})}function fetchANDsave(t,i,a,e){var n=t.adcode,s="data/"+n+"_drw_"+t.spell+".json",o=config.dataServer+s;$.ajax({url:o,dataType:"json",success:function(t){i.local[s]=i.remoteVersion,localize(versionKey,i.local),localize(s.slice(0,-5),t),console.log("@saving",s),a&&a(n)},error:function(){e&&e()}})}function checkCity(t,i){var a="data/"+t+"_drw_"+i.spell+".json";checkVersion(a,function(a,e){a?($(document).trigger("update:start",t),fetchANDsave(i,e,function(t){$(document).trigger("update:end",t,i)},function(){$(document).trigger("update:end:err")})):$(document).trigger("update:up2date",t)})}function diffCitylist(t,i){var a,e=[];for(a in i)t[a]||a.indexOf("_drw_")>=0&&e.push({key:a,value:i[a],adcode:a.match(/\d+/)[0],spell:a.match(/_drw_(\w+)\.json/)[1]});return e}function parallelFetch(t,i,a,e,n){var s=t.length,o=0,r=[],c=!1;$.each(t,function(t,d){$(document).trigger("city:update:start",d),$.ajax({url:config.dataServer+d,dataType:"json",success:function(a){var e={key:d,data:a};r.push(e),lv[d]=rv[d],localize(versionKey,lv),localize(d.slice(0,-5),a),$(document).trigger("city:update:end",i[t])},error:function(t){c=!0,r.push(t)},complete:function(){c||a(),++o==s&&(c?n(r):e(r))}})})}function checkCitylist(){var t="data/citylist.json",i=config.dataServer+t;checkVersion(t,function(a,e){a?($(document).trigger("citylist:update:start"),$.ajax({url:i,dataType:"json",success:function(i){var a=diffCitylist(e.local,e.remote);if(a.length){var n=[],s=[];a.forEach(function(t){var a=i.citylist.filter(function(i){return t.adcode==i.adcode})[0];a&&(t.cityname=a.cityname),n.push("data/"+a.adcode+"_drw_"+a.spell+".json"),s.push(a)}),$(document).trigger("citylist:update:end",a),parallelFetch(n,s,function(){localize(t.slice(0,-5),i)},function(i){e.local[t]=e.remoteVersion,localize(versionKey,e.local),$(document).trigger("citylist:update:end",i)},function(t){$(document).trigger("citylist:update:err")})}},error:function(){$(document).trigger("citylist:update:err")}})):$(document).trigger("citylist:update:up2date")})}define("app/js/util",[],function(){var t={};return t.isArray=function(t){return"[object Array]"==toString.call(t)},t.isString=function(t){return"[object String]"==toString.call(t)},t.has=function(t,i){return hasOwnProperty.call(t,i)},t.isEmpty=function(i){if(null==i)return!0;if(t.isArray(i)||t.isString(i))return 0===i.length;for(var a in i)if(t.has(i,a))return!1;return!0},t.param2json=function(t){if(t&&""!=t){var i=t.split("&"),a={};if(i.length>0)for(var e=0;e<i.length;e++){var n=i[e].split("="),s=n[0],o=n[1];a[s]=o}return a}return null},t.formatTime=function(t){if(!t||"0"==t)return"";if(t/=60,t<=60)return parseInt(Math.ceil(t))+"分钟";var i=Math.floor(t/60)+"小时";return t%60!==0&&(0===Math.floor(t%60)||(i+=Math.floor(t%60)+"分钟")),i},t.loading=function(){$(".loading-outer").css("position","fixed"),$(".loading-bg").css({position:"fixed",display:"block"}),$(".loading-bg .loading").css("top","-30px")},t.loadingOver=function(){$(".loading-bg").css("display","none")},t}),define("app/js/subwayapi",["app/js/util"],function(t){var i={subwayInit:function(i){var a=this;if(!subwayObj){var e=$(".top_bar").height(),n={top:e+34,left:0,bottom:62,right:0};subwayObj=subway("subwaybody",{theme:"colorful",client:1,offset:n}),subwayObj.event.on("subway.complete",function(i){t.loadingOver();var e=subwayapp.cityParam,n=subwayapp.curCity,s=e&&e.detail,o=e&&e.lnglat,r=e&&e.poiid;if(o&&e.city==n.adcode)if(s){if(a.detail=a.detailStation(r,o),!a.detail)return;var c={type:"circle",r:14,customClass:"subway_detail_circle"};subwayObj.addCustomNode(a.detail,c),setTimeout(function(){var t=subwayObj.getStCenter(a.detail);subwayObj.setCenter(t,{animate:a.animate})},150)}else{if(a.near=a.nearStation(o),!a.near)return;var c={type:"circle",r:14,customClass:"subway_near_circle"};subwayObj.addCustomNode(a.near,c),setTimeout(function(){var t=subwayObj.getStCenter(a.near);subwayObj.setCenter(t,{animate:a.animate}),a.nearTip(a.near)},150)}}),subwayObj.event.on("station.touch",function(t,i){a.openStationInfo(i)}),subwayObj.event.on("stationName.touch",function(t,i){a.openStationInfo(i)}),subwayObj.event.on("lineName.touch",function(t,i){subwayObj.showLine(i.id);var a=$("#g-select");subwayObj.setFitView(a);var e=subwayObj.getSelectedLineCenter();subwayObj.setCenter(e)}),subwayObj.event.on("subway.touch",function(){subwayObj.clearInfoWindow()})}subwayObj.setData(i)},openStationInfo:function(t){var i=this,a=t.id,e=t.name,n=t.poiid,s=t.lnglat;i.activeStation=t,subwayObj.clearInfoWindow(),subwayObj&&subwayObj.stopAnimation(),subwayObj.addInfoWindow(a,{content:'<div class="tip_wrap" data-name="'+e+'" data-id="'+a+'" data-poiid="'+n+'" data-lnglat="'+s+'"><div class="tip_bady"><div class="tip_name_detail"><span class="tip_name" id="tip_name">'+e+'</span><span class="tip_detail ust">详情></span></div><div class="tip_route"><div class="route_btn tip_route_start ust" data-type="start">设为起点</div><div class="route_btn tip_route_end ust" data-type="end">设为终点</div></div></div><div class="tip_footer"></div></div>'});var o=subwayObj.getStCenter(a);subwayObj.setCenter(o),subwayapp.nearIsOpen&&(subwayapp.nearIsOpen=!1)},nearStation:function(t){if(t){var i=subwayObj.getNearStation({lnglat:t});return i}},detailStation:function(t,i){var a=this,e=null;return t&&(e=subwayObj.getIdByPoiid(t)),t&&e!=-1||!i||(e=a.nearStation(i)),e},nearTip:function(t){subwayObj.addInfoWindow(t,{content:'<div class="tip-near tip-t"><img class="near-img" width="100" src="app/img/near_t.png"></div>',offset:{x:0,y:-13}}),subwayapp.nearIsOpen=!0},getData:function(i,a){var e=this;e.animate=a,$(".subwaypage").removeClass("hidden"),t.loading();var i=i||subwayapp.curCity&&subwayapp.curCity.adcode;if(i){var n="data/"+i+"_drw_"+subwayapp.curCity.spell;require.undef(n),require([n],function(t){e.subwayInit(t)})}else t.loadingOver()},showCityName:function(){$(".city_list_btn").removeClass("hide")},hideCityName:function(){$(".city_list_btn").addClass("hide")}};return i}),define("app/js/route",["app/js/util"],function(t){var i={routeFlag:!1,startInfo:null,endInfo:null,dirState:!1,routeDtailInfo:{start:null,end:null},pathdata:null,init:function(){var t=this;t.bindEvent()},bindEvent:function(){var t=this;$(".route_entry");$(".route_close").on("touchend",function(){var i=$(this).closest(".route_ipt").attr("srhtype"),a=null;"start"==i?a=t.startInfo.id:"end"==i&&(a=t.endInfo.id),t.closeDir([i]),t.clearStartEnd(i,a)}),$(".dir_close_btn").on("touchend",function(){t.closeDir(["start","end"])}),$("#setSwitch").on("touchend",function(){var i=t.startInfo&&t.startInfo.id,a=t.endInfo&&t.endInfo.id,e=$.extend(!0,{},t.startInfo),n=$.extend(!0,{},t.endInfo);if(a&&n)t.setStartEnd("start",a,n);else{var s=["start"];t.closeDir(s)}if(i&&e)t.setStartEnd("end",i,e);else{var s=["end"];t.closeDir(s)}t.dir()}),$(".route_bar").on("click",function(){return t.searchRouteDetail(),!1})},setStartEnd:function(t,i,a,e){var n=this,s=a.name;a.poiid;if(subwayObj.stopAnimation(),n.setStartEndIpt(t,s),"start"==t?(n.endInfo&&n.endInfo.id==i&&(n.clearStartEnd("end",i),n.clearDir()),subwayObj.setStart(i,{width:23,height:30,offset:{x:0,y:0},cnt:"<div class='start_img route_img'></div>"})):"end"==t&&(n.startInfo&&n.startInfo.id==i&&(n.clearStartEnd("start",i),n.clearDir()),subwayObj.setEnd(i,{width:23,height:30,offset:{x:0,y:0},cnt:"<div class='end_img route_img'></div>"})),n.setStartEndInfo(t,a),e&&"srh"==e)if(n.startInfo&&n.endInfo);else{var o=subwayObj.getStCenter(i);subwayObj.setCenter(o)}},setStartEndInfo:function(t,i){var a=this;"start"==t?a.startInfo=i:"end"==t&&(a.endInfo=i)},setStartEndIpt:function(t,i){var a=null;"start"==t?a=$("#setStart"):"end"==t&&(a=$("#setEnd")),a.find(".route_startend").html(i).removeClass("route_placeholder"),a.find(".route_close").removeClass("hidden")},clearStartEndIpt:function(t){var i={start:"起点",end:"终点"};$(".route_close_"+t).addClass("hidden"),$(".route_"+t).html(i[t]).addClass("route_placeholder")},clearStartEnd:function(t,i){var a=this;a.clearStartEndIpt(t),subwayObj&&subwayObj.clearMarker(i),"start"==t?a.startInfo=null:"end"==t&&(a.endInfo=null)},clearAllStartEnd:function(){var t=this,i=t.startInfo.id,a=t.endInfo.id;t.clearStartEnd("start",i),t.clearStartEnd("end",a)},getDirDataNative:function(t){var i=this,a=i.startInfo,e=i.endInfo;POI.send({action:"aosrequest",alert:{fail:"请检查网络后重试"},urlPrefix:"http://s.amap.com/ws/transfer/auth/navigation/bus-ext/",method:"GET",params:[{x1:a.lon,sign:1},{y1:a.lat,sign:1},{x2:e.lon,sign:1},{y2:e.lat,sign:1},{poiid1:a.poiid,sign:1},{poiid2:e.poiid,sign:1},{type:"6"},{Ver:3}]},function(i){var a=JSON.parse(i.content);t(a)})},getDirDataM:function(t){var i=this,a=i.startInfo,e=i.endInfo;$.ajax({url:config.mDirServer,data:{x1:a.lon,y1:a.lat,x2:e.lon,y2:e.lat,poiid1:a.poiid,poiid2:e.poiid,type:"6",Ver:3},type:"get",method:"get",dataType:"json",success:function(i){t&&t(i)},error:function(){alert("请检查网络后重试")}})},dir:function(){var i=this;if(i.startInfo&&i.endInfo){i.clearDir(),t.loading();var a=function(a){var e=a.code+"";if("1"==e&&"1"==a.count&&a.buslist[0]){var n=a.buslist[0],s=i.startInfo,o=i.endInfo;i.pathdata=a,i.routeDtailInfo.start=n.spoi,i.routeDtailInfo.end=n.epoi;var r={start:s.poiid,end:o.poiid,routedata:a,closeBtn:!1},c=subwayObj.routeWithData(r);c?(i.hideFilter(),i.showCloseBtn(),i.showRouteBar(a,c),i.dirState=!0):isNative?POI.send({action:"nativeAlert",title:"",message:"抱歉，没有合适的地铁路线",cancelbutton:"确定"},function(t){i.dirErr()}):(alert("抱歉，没有合适的地铁路线"),i.dirErr())}else"-1"!==e&&"-2"!==e?isNative?POI.send({action:"nativeAlert",title:"",message:"抱歉，未找到路线",cancelbutton:"确定"},function(t){i.dirErr()}):(alert("抱歉，未找到路线"),i.dirErr()):"-1"==e?(isNative?POI.send({action:"promptMessage",message:"请检查网络后重试",type:0}):alert("请检查网络后重试"),i.dirErr()):"-2"==e?POI.send({action:"promptMessage",message:"当前网络不稳定，请稍后重试",type:0},function(t){i.dirErr()}):i.dirErr();t.loadingOver()};isNative?i.getDirDataNative(a):i.getDirDataM(a)}},dirErr:function(){var t=this;setTimeout(function(){t.closeDir(["start","end"]),t.dirState=!1},110)},clearDir:function(){var t=this;subwayObj&&subwayObj.clearLine(),subwayObj&&subwayObj.clearRoute(),subwayObj&&subwayObj.clearInfoWindow(),t.hideRouteBar()},closeDir:function(t){var i=this;subwayObj&&subwayObj.clearRoute(),$.each(t,function(t,a){var e="";e="start"==a?i.startInfo&&i.startInfo.id:i.endInfo&&i.endInfo.id,i.clearStartEnd(a,e)}),i.showFilter(),i.hideCloseBtn(),i.hideRouteBar(),i.dirState=!1},switchDir:function(){},showRouteBar:function(i,a){var e=i.buslist[0];if(e){for(var n=e.segmentlist,s=a.linesbar,o=[],r=0;r<s.length;r++)o.push(s[r].ln);for(var c=e.expense+"元",d=t.formatTime(e.expensetime),u=0,l=0;l<n.length;l++)u+=Number(n[l].passdepotcount)+1;var p='<span class="step_arrow"></span>',f=o.join(p),h=[d,u+"站",c],y='<span class="dot"></span>',b=h.join(y);$(".route_line").html(f),$(".route_info").html(b),$(".route_bar").show()}},hideRouteBar:function(){$(".route_bar").hide()},showCloseBtn:function(){$(".dir_close_btn").removeClass("hidden")},hideCloseBtn:function(){$(".dir_close_btn").addClass("hidden")},unableFilter:function(){$(".filter_btn").css({"z-index":"10"})},ableFilter:function(){$(".filter_btn").css({"z-index":"20"})},hideFilter:function(){$(".filter_btn").hide()},showFilter:function(){$(".filter_btn").show()},searchRouteDetail:function(){var t=this;isNative&&POI.send({action:"searchRouteDetail",startPoi:{name:t.startInfo.name,poiid:t.startInfo.poiid,lon:t.routeDtailInfo.start.x,lat:t.routeDtailInfo.start.y},endPoi:{name:t.endInfo.name,poiid:t.endInfo.poiid,lon:t.routeDtailInfo.end.x,lat:t.routeDtailInfo.end.y},pathData:t.pathdata})}};return i}),define("app/js/search",["app/js/route"],function(t){var i={hasBind:!1,init:function(){var t=this;t.hasBind||t.bindEvent()},bindEvent:function(){var i=this,a=$("#searchpage");a.on("touchend","#back_ipt",function(){i.hideSrhPage()}),a.on("input","#search_ipt",function(){var t=$(this).val();i.getSug(t)}),a.on("touchend","#search_ipt",function(){$("#search_ipt").focus()}),a.on("blur","#search_ipt",function(){$(this).blur()}),a.on("click",".st_item",function(){var a=$(this),e=a.data("stid"),n=$(this).data("poiid"),s=a.data("name"),o=a.data("lon"),r=a.data("lat"),c=a.closest("#searchpage").attr("type"),d={id:e,name:s,poiid:n,lon:o,lat:r},u="srh";i.hideSrhPage(),subwayObj&&subwayObj.clearInfoWindow(),t.setStartEnd(c,e,d,u),t.dir()});var e=0;a.on("click",".sug_err",function(){if(e+=1,e>10){var t="vertime:Tue Apr 18 2017 11:19:39 GMT+0800 (CST)";isNative?POI.send({action:"nativeAlert",title:"",message:t,cancelbutton:"确定"},function(){e=0}):e=(confirm(t),0)}}),i.hasBind=!0},showVer:function(){},hideSrhPage:function(){$("#search_ipt").blur(),$(".subwaypage").removeClass("hidden");var t=$("#searchpage");t.addClass("hidden")},getSug:function(t){var i=this,t=$.trim(t);if(t&&""!=t){var a=function(t){i.showSug(t)};subwayObj.stationSearch(t,a)}else $("#searchlist").html(" ").addClass("hidden")},showSug:function(t){var i=$("#searchlist"),a=$(".sug_err");if(t&&t.stationList.length>0){var e=t.keyword,n=t.stationList,s=[];$.each(n,function(t,i){var a=i.referlines;a=a.sort(function(t,i){return Number(t.index)>Number(i.index)?1:-1});var n="";$.each(a,function(t,i){n+='<li class="rfline" style="background:#'+i.color+'">'+i.name+"</li>"});var o=i.name;if(o.indexOf(e)>=0)var r='<b class="match">'+e+"</b>"+o.substring(e.length,o.length);else var r=o;var c=i.lnglat.split(",")[0],d=i.lnglat.split(",")[1];s.push('<li class="st_item" data-poiid="'+i.poiid+'" data-stid="'+i.id+'" data-name="'+i.name+'" data-lon="'+c+'" data-lat="'+d+'"><div class="st_item_wrap"><span class="st_name">'+r+'</span><ul class="st_rfline">'+n+'</ul><div class="clr"></div></div></li>')}),a.addClass("hidden"),i.html(" ").removeClass("hidden").html(s.join(""))}else i.html(" ").addClass("hidden"),a.removeClass("hidden")}};return i});var versionKey="data/version",rv,lv;define("app/js/dataupdater",{checkCitylist:checkCitylist,checkCity:checkCity}),define("app/js/city",["app/js/util","app/js/subwayapi","app/js/route","app/js/search","app/js/dataupdater"],function(t,i,a,e,n){var s={subwayFlag:!0,bindEvent:function(){var t=this,i=$("#citylistpage");i.on("click",".cityitem",function(){var i=$(this).attr("adcode");t.cityChange(i),i==(subwayapp.cityParam&&subwayapp.cityParam.city)&&($("#cltip").hide(),$("#os").removeClass("newcity"))}),i.on("touchend","#back_subway",function(){return subwayapp.curCity&&subwayapp.curCity.adcode?void t.hideCitylist():void(t.subwayFlag?t.hideCitylist():isNative?POI.send({action:"webviewGoBack"}):alert("模拟返回到客户端"))}),$("#cltip").on("click",function(){var i=subwayapp.cityParam.city;i&&(t.cityChange(i),$(this).hide(),$("#os").removeClass("newcity"))})},init:function(t,i){var a=this,e=i.citylist;subwayapp.citylist=e,subwayapp.citylistObj={},$.each(e,function(t,i){subwayapp.citylistObj[i.adcode]=i}),a.bindEvent(),t&&subwayapp.citylistObj[t]?a.initCurCity(t):(a.showCitylist(),a.subwayFlag=!1)},initCurCity:function(t){var i=this;if(t&&subwayapp.citylistObj[t]){subwayapp.curCity=subwayapp.citylistObj[t],$(".filter_btn").removeClass("hidden");var a=i.getCityByadcode(t),e=a.cityname;i.resetTopbar(e),$(".city_name").text(e),n.checkCity(t,a)}},resetTopbar:function(t){var i=16,a=26,e=2*i+a;t&&t.length>0&&(e=t.length*i+a),$(".route_entry").css("padding-right",e)},showCitylist:function(){var t=this;subwayObj&&subwayObj.stopAnimation(),n.checkCitylist(),t.citylistInit(),$(".subwaypage").addClass("hidden"),$("#citylistpage").removeClass("hidden")},hideCitylist:function(){$(".subwaypage").removeClass("hidden"),$("#citylistpage").addClass("hidden")},citylistInit:function(i){var a=this,i=i||subwayapp.citylist,e=$("#citylist");if(!t.isEmpty(i)){var n="";a.citylistObj={};for(var s=0;s<i.length;s++)a.citylistObj[i[s].adcode]=i[s],n+='<li class="cityitem" adcode="'+i[s].adcode+'"><a href="javascript:void(0)">'+i[s].cityname+"</a></li>";e.html(n)}t.loadingOver()},reShowCitylist:function(t){var i=this,a="data/citylist";require.undef(a),require([a],function(a){var a=a.citylist;subwayapp.citylistObj={},$.each(a,function(i,a){subwayapp.citylistObj[a.adcode]=a,a.adcode==t&&subwayapp.citylist.push(a)}),i.citylistInit(subwayapp.citylist)})},cityChange:function(t){var n=this;a.closeDir(["start","end"]),subwayObj&&subwayObj.stopAnimation(),subwayObj&&subwayObj.clearOverlays(),n.initCurCity(t),i.getData(t),n.hideCitylist(),e.hideSrhPage()},loadCityData:function(t,i){},getCityByadcode:function(t){var i=subwayapp.citylistObj;return t?i[t]:null}};return s}),define("app/js/main",["app/js/city","app/js/search","app/js/route"],function(t,i,a){var e={init:function(){var t=this;t.bindEvent()},bindEvent:function(){var i=this,e=$(".subwaybody");"ios"==OSName&&$(".top_bar").on("touchstart",function(t){t.preventDefault()}),$(".city_list_btn").on("touchend",function(){t.showCitylist()}),$(".filter_btn").on("touchend",function(){i.showFilter()}),$(".flier_close_btn").on("touchend",function(){i.closeFilter()}),$(".light_box").on("click",function(){i.closeFilter()}),$(".fliter_detail").on("click",".fliter_item",function(){if(!s){var t=$(this).attr("lineid");i.closeFilter(),i.showFilterLine(t)}}),$("#back_amap").on("touchend",function(){a.dirState?a.closeDir(["start","end"]):isNative&&POI.send({action:"webviewGoBack"})});var n,s=!1;$(".fliter_detail").on("touchmove",function(t){t.stopPropagation(),s=!0,n&&clearTimeout(n),n=setTimeout(function(){s=!1},60)}),$(".route_startend").on("touchend",function(){var t=$(this).closest(".route_ipt").attr("srhtype");i.showSearchPage(t)}),e.on("touchend",".route_btn",function(){var t=$(this).data("type"),i=$(this).closest(".tip_wrap"),e=i.data("id"),n={id:e,name:i.data("name"),poiid:i.data("poiid"),lon:i.data("lnglat").split(",")[0],lat:i.data("lnglat").split(",")[1]};return setTimeout(function(){a.setStartEnd(t,e,n),subwayObj.clearInfoWindow(),a.dir()},0),!1}),e.on("touchend",".subway-tip",function(t){"near-img"!=t.target.className&&t.stopPropagation()}),e.on("touchstart",".subway-tip",function(t){"near-img"!=t.target.className&&t.stopPropagation()}),e.on("touchend",".tip_name_detail",function(t){t.stopPropagation();var a=$(this).closest(".tip_wrap"),e=a.data("lnglat").split(","),n={name:a.data("name"),poiid:a.data("poiid"),lon:e[0],lat:e[1]};i.openPoi(n)}),$(".light_box").on("touchmove",function(t){t.preventDefault()}),$(".light_box").on("click",function(){i.closeFilter()})},closeInfowindow:function(){},openPoi:function(t){t&&isNative&&POI.send({action:"openPoi",poiInfo:t,status:"1"})},showFilter:function(){var t=function(t){var i=t,a=$(".fliter_detail");a.html(" ");for(var e=0;e<i.length;e++){var n=$('<li class="fliter_item"></li>'),s=i[e].laname,o="",r="";r=s&&""!=s?i[e].name+'<b class="line_name_la">( '+i[e].laname+" )</b>":i[e].name,o='<span class="line_color" style="background:#'+i[e].color+'"></span><span class="line_name">'+r+"</span>",n.html(o),n.attr("id","caption-"+i[e].id),n.attr("lineid",i[e].id),a.append(n)}$(".light_box, .filter_list").removeClass("hidden")};subwayObj.getLinelist(t)},closeFilter:function(){$(".light_box, .filter_list").addClass("hidden")},showFilterLine:function(t){subwayObj.stopAnimation(),subwayObj.showLine(t);var i=$("#g-select");subwayObj.setFitView(i);var a=subwayObj.getSelectedLineCenter();subwayObj.setCenter(a)},closeFilterLine:function(){},showSearchPage:function(t){$(".subwaypage").addClass("hidden");var a="输入起点",e=$("#searchpage");"end"==t&&(a="输入终点"),e.attr("type",t),e.find("#search_ipt").attr("placeholder",a).val(""),e.find("#searchlist").html(" ").addClass("hidden"),e.find(".sug_err").addClass("hidden"),e.removeClass("hidden"),e.find("#search_ipt").trigger("click"),e.find("#search_ipt").focus(),i.init()}};return e}),define("app/js/dataupdater.ui",["app/js/subwayapi","app/js/city"],function(t,i){function a(t){var i=store.getItem("update.ui.tip@"+t);i=!!parseInt(i),i&&(c.show(1),store.setItem("update.ui.tip@"+t,0),setTimeout(function(){c.hide(1)},2e3))}function e(t){c.show(0)}function n(t){setTimeout(function(){c.hide(0),d(t)},500)}function s(t){c.hide(0),c.show(3),setTimeout(function(){c.hide(3)},2e3)}function o(t){var a=t.adcode;i.reShowCitylist(a);var e=subwayapp.cityParam&&subwayapp.cityParam.city,n=null;a==e&&(n=t.cityname,r(n),c.show(2))}function r(t){$("#curcity").html(t),$("#os").addClass("newcity")}var c={dom:[$("#dltip"),$("#ndtip"),$("#cltip"),$("#errtip")],show:function(t){this.dom[t].show()},hide:function(t){this.dom[t].hide()}},d=function(i){if(isNative)POI.send({action:"nativeAlert",title:"",message:"已为您更新至最新版地铁图，刷新查看",cancelbutton:"取消",otherbuttons:["好"]},function(e){if(1==e.result){var n=!1;t.getData(null,n),setTimeout(function(){a(i)},500)}});else{var e=confirm("已为您更新至最新版地铁图，刷新查看");if(e){var n=!1;t.getData(null,n),setTimeout(function(){a(i)},500)}}};$(document).on("update:start",function(t,i){e()}),$(document).on("update:end",function(t,i){n(i),store.setItem("update.ui.tip@"+i,1)}),$(document).on("update:end:err",function(t){s()}),$(document).on("update:up2date",function(t,i){a(i)}),$(document).on("city:update:end",function(t,i){o(i)}),$(document).on("citylist:update:end",function(t){[].slice.call(arguments,1)})}),define("app/js/app",["app/js/util","app/js/city","app/js/subwayapi","app/js/main","app/js/route","app/js/dataupdater.ui"],function(t,i,a,e,n){!function(s){FastClick.attach(document.body);var o=null,r=window.location.hash.replace(/^\#/,"");o=isNative?"ios"==os?t.param2json(r):{city:amapKvStorageInit.getItem("city"),lnglat:amapKvStorageInit.getItem("lnglat"),poiid:amapKvStorageInit.getItem("poiid"),detail:amapKvStorageInit.getItem("detail")}:t.param2json(r),subwayapp.cityParam=o;var c=null;o&&o.city&&(c=o.city&&o.city.substr(0,4),subwayapp.cityParam.city=c);var d="data/citylist";require([d],function(t){i.init(c,t),a.getData(),e.init(),n.init()})}()});
